<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shrine Sparks Preview</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: #000; display: flex; justify-content: center; align-items: center; min-height: 100vh; }

  .shrine-wrapper {
    position: relative;
    display: inline-block;
    max-width: 1000px;
    width: 100%;
    overflow: hidden;
    line-height: 0;
  }

  .shrine-bg {
    width: 100%;
    height: auto;
    display: block;
  }

  .spark-overlay {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
  }
</style>
</head>
<body>

<div class="shrine-wrapper">
  <img src="shrineBG.webp" alt="Shrine background" class="shrine-bg" />
  <canvas id="sparkCanvas" class="spark-overlay" aria-hidden="true"></canvas>
</div>

<script>
  const canvas = document.getElementById('sparkCanvas');
  const ctx = canvas.getContext('2d');

  function resize() {
    canvas.width  = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;
  }
  resize();
  window.addEventListener('resize', resize);

  function spawnSpark() {
    const w = canvas.width;
    const h = canvas.height;
    const xMin = w * 0.35, xMax = w * 0.65;
    const yMin = h * 0.55, yMax = h * 0.95;

    return {
      x: xMin + Math.random() * (xMax - xMin),
      y: yMin + Math.random() * (yMax - yMin),
      vx: (Math.random() - 0.5) * 0.6,
      vy: -(0.6 + Math.random() * 1.4),
      size: 1.2 + Math.random() * 3.5,
      alpha: 0,
      life: 0,
      lifeSpeed: 0.004 + Math.random() * 0.006,
      twinkle: Math.random() * Math.PI * 2,
      color: `hsl(${200 + Math.random() * 40}, 100%, ${75 + Math.random() * 25}%)`,
    };
  }

  const sparks = [];
  for (let i = 0; i < 60; i++) {
    const s = spawnSpark();
    s.life = Math.random();
    sparks.push(s);
  }

  function drawStar(x, y, size, alpha, color, twinkle, time) {
    const shimmer = 0.7 + 0.3 * Math.sin(time * 6 + twinkle);
    const a = alpha * shimmer;
    if (a <= 0) return;

    ctx.save();
    ctx.globalAlpha = a;
    ctx.translate(x, y);

    // Outer glow
    const glow = ctx.createRadialGradient(0, 0, 0, 0, 0, size * 5);
    glow.addColorStop(0, 'rgba(120,220,255,0.35)');
    glow.addColorStop(1, 'rgba(30,100,255,0)');
    ctx.fillStyle = glow;
    ctx.beginPath();
    ctx.arc(0, 0, size * 5, 0, Math.PI * 2);
    ctx.fill();

    // Beams
    const long  = size * 4.5;
    const short = size * 2.5;
    const thin  = size * 0.25;

    function drawBeam(angle, len) {
      ctx.save();
      ctx.rotate(angle);
      const grad = ctx.createLinearGradient(-len, 0, len, 0);
      grad.addColorStop(0,   'rgba(255,255,255,0)');
      grad.addColorStop(0.5, color);
      grad.addColorStop(1,   'rgba(255,255,255,0)');
      ctx.fillStyle = grad;
      ctx.beginPath();
      ctx.ellipse(0, 0, len, thin, 0, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();
    }

    drawBeam(0, long);
    drawBeam(Math.PI / 2, long);
    drawBeam(Math.PI / 4, short);
    drawBeam(-Math.PI / 4, short);

    // Core
    const core = ctx.createRadialGradient(0, 0, 0, 0, 0, size);
    core.addColorStop(0, 'white');
    core.addColorStop(1, 'rgba(120,220,255,0)');
    ctx.fillStyle = core;
    ctx.beginPath();
    ctx.arc(0, 0, size, 0, Math.PI * 2);
    ctx.fill();

    ctx.restore();
  }

  let t = 0;
  function tick() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    t += 0.016;

    for (const s of sparks) {
      s.life += s.lifeSpeed;

      s.alpha = s.life < 0.2
        ? s.life / 0.2
        : s.life < 0.75
          ? 1
          : 1 - (s.life - 0.75) / 0.25;

      s.alpha = Math.max(0, Math.min(1, s.alpha));
      s.x += s.vx + Math.sin(t * 1.5 + s.twinkle) * 0.15;
      s.y += s.vy;

      drawStar(s.x, s.y, s.size, s.alpha, s.color, s.twinkle, t);

      if (s.life >= 1) Object.assign(s, spawnSpark());
    }

    requestAnimationFrame(tick);
  }

  tick();
</script>

</body>
</html>
