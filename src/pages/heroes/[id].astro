---
import { heroes, getHeroById, statMaxima } from "../../data/heroes";


/* STATIC PATHS */
export function getStaticPaths() {
  return heroes.map((hero) => ({
    params: { id: hero.id },
  }));
}

const { id } = Astro.params;
const hero = getHeroById(id);

if (!hero) {
  throw new Error(`Hero with id "${id}" not found`);
}

const TIER_RATINGS = [
  {
    group: "Overall",
    items: [
      { label: "Overall", key: "overall" },
    ],
  },
  {
    group: "PvE",
    items: [
      { label: "Grim Surge", key: "grimSurge" },
      { label: "Delusion's Den", key: "delusionsDen" },
      { label: "Torrent Rift", key: "torrentRift" },
    ],
  },
  {
    group: "PvP",
    items: [
      { label: "PvP", key: "pvp" },
    ],
  },
];

const PERCENT_STATS = new Set([
  "dodgeRate",
  "hitBonus",
  "critRate",
  "critRes",
  "critDmgBonus",
  "critDmgReduction",
]);

const STAT_LABELS = {
  hp: "HP",
  atk: "ATK",
  armor: "Armor",
  magicRes: "M-Res",
  dodgeRate: "Dodge",
  hitBonus: "Hit",
  critRate: "Crit Rate",
  critRes: "Crit RES",
  critDmgBonus: "Crit DMG",
  critDmgReduction: "Crit Red",
  energy: "Energy",
};
const TIER_GROUPS = [
  {
    title: "PvE",
    items: [
      { key: "grimSurge", label: "Grim Surge" },
      { key: "delusionsDen", label: "Delusion's Den" },
      { key: "torrentRift", label: "Torrent Rift" },
    ],
  },
  {
    title: "PvP",
    items: [{ key: "pvp", label: "PvP" }],
  },
];
---

<head>
  <meta charset="utf-8" />
</head>

<div class="hero-detail-page">
  <!-- STICKY HEADER -->
  <header class="hero-detail-header">
    <div class="header-inner header-with-back">
      <a href="/" class="back-button">‚Üê Back</a>

      <div class="header-center">
        <h1 class="hero-title">{hero.name}</h1>

        <nav class="hero-tabs">
          <button class="tab active">Attributes</button>
          <button class="tab">Skills</button>
          <button class="tab">Team Recommendations</button>
        </nav>
      </div>
    </div>
  </header>

  <!-- CONTENT -->
  <main class="hero-detail-content">
    <section class="hero-overview">
      <!-- LEFT -->
      <div>
        <!-- LARGE HERO NAME -->
        <h2 class="hero-name-large">{hero.name}</h2>
        
        <!-- Description  -->
        {hero.description && (
          <p class="hero-description">
            {hero.description}
          </p>
        )}
        <!-- FACTION -->
        <div class="hero-faction">
          <img
            src={`${import.meta.env.BASE_URL}icons/factions/${hero.faction.toLowerCase()}.webp`}
            alt={hero.faction}
            class="faction-icon"
          />
          <span class="faction-label">{hero.faction}</span>
        </div>

        <!-- IDENTITY CARDS -->
        <div class="hero-identity-cards">
          <div class="identity-card">
            <h4>Class</h4>
            <div class="identity-content">
              <img
                class="identity-icons"
                src={`${import.meta.env.BASE_URL}icons/classes/${hero.faction.toLowerCase()}.webp`}
                alt={hero.class}
              />
              <span>{hero.class}</span>
            </div>
          </div>

          <div class="identity-card">
            <h4>Role</h4>
            <div class="identity-content">
              <img
                class="identity-icons"
                src={`${import.meta.env.BASE_URL}icons/roles/${hero.faction.toLowerCase()}.webp`}
                alt={hero.role}
              />
              <span>{hero.role}</span>
            </div>
          </div>

          <div class="identity-card">
            <h4>Rarity</h4>

            <div class="identity-content rarity-content">
              <!-- Stern -->
              <svg class="rarity-star" viewBox="0 0 24 24" aria-hidden="true">
                <path
                  d="M12 2l2.9 6.1 6.7.6-5 4.5 1.5 6.6L12 16.8 5.9 19.8 7.4 13.2 2.4 8.7l6.7-.6L12 2z"
                ></path>
              </svg>

              <span>{hero.rarity}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="hero-visual" style={`background-image: url(${import.meta.env.BASE_URL}heroes/${hero.id}.webp);`}>
      </div>
    </section>

    <!-- STATS -->
    <section class="hero-stats">
        <h2>Base-Stats (LvL1)</h2>

        <div class="stats-grid">
          {Object.entries(STAT_LABELS).map(([key, label]) => (
            <div class="stat-row">
              <span class="stat-label">{label}</span>

              <div class="stat-right">
                <span class="stat-value">
                  <span class="stat-current">
                    {hero.stats[key]}
                    <span class="stat-max"> / {statMaxima[key]}</span>
                  </span>

                  {hero.rankings?.[key] && (
                    <small class="stat-rank">
                      #{hero.rankings[key]}
                    </small>
                  )}
                </span>

                <!-- üî• STAT BAR -->
                <div class="stat-bar">
                  <div
                    class={`stat-bar-fill ${
                      hero.rankings?.[key] === 1
                        ? "rank-1"
                        : hero.rankings?.[key] === 2
                        ? "rank-2"
                        : hero.rankings?.[key] === 3
                        ? "rank-3"
                        : hero.rankings?.[key] <= 10
                        ? "rank-top"
                        : "rank-default"
                    }`}
                    style={`width: ${
                      statMaxima[key]
                        ? Math.min((hero.stats[key] / statMaxima[key]) * 100, 100)
                        : 0
                    }%`}
                  />
                </div>
              </div>
            </div>
          ))}
        </div>

      </section>
      <section class="hero-tier-rating">
  <h2>Tier Rating</h2>

  <div class="tier-layout">
    <!-- OVERALL -->
    <div class="tier-overall">
      <span class="tier-title">Overall</span>
      <span class={`tier-value tier-${hero.ratings?.overall?.toLowerCase()}`}>
        {hero.ratings?.overall ?? "-"}
      </span>
    </div>

    <!-- GROUPS -->
    <div class="tier-groups">
      {TIER_GROUPS.map(group => (
        <div class="tier-group">
          <h3>{group.title}</h3>

          <div class="tier-cards">
            {group.items.map(item => (
              <div class="tier-card">
                <span class="tier-card-label">{item.label}</span>
                <span
                  class={`tier-card-value tier-${
                    hero.ratings?.[item.key]?.toLowerCase() ?? "none"
                  }`}
                >
                  {hero.ratings?.[item.key] ?? "-"}
                </span>
              </div>
            ))}
          </div>
        </div>
      ))}
    </div>
  </div>
</section>
  </main>
</div>

<style>
 /* ===============================
   TIER RATING
   =============================== */

.hero-tier-rating {
  margin-top: 96px;
}

.tier-layout {
  display: grid;
  grid-template-columns: 220px 1fr;
  gap: 48px;
  align-items: start;
}

/* OVERALL */
.tier-overall {
  background: radial-gradient(
    circle at top,
    rgba(255,120,80,0.35),
    rgba(0,0,0,0.6)
  );
  border: 1px solid rgba(255,255,255,0.25);
  border-radius: 18px;
  padding: 24px;
  text-align: center;
}

.tier-title {
  display: block;
  font-size: 0.85rem;
  opacity: 0.7;
  margin-bottom: 8px;
}

.tier-value {
  font-size: 56px;
  font-weight: 700;
  letter-spacing: 2px;
}

/* GROUPS */
.tier-groups {
  display: flex;
  flex-direction: column;
  gap: 32px;
}

.tier-group h3 {
  margin: 0 0 12px;
  font-size: 0.9rem;
  opacity: 0.8;
  text-transform: uppercase;
}

.tier-cards {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
}

.tier-card {
  min-width: 160px;
  padding: 12px 14px;
  background: rgba(0,0,0,0.35);
  border: 1px solid rgba(255,255,255,0.18);
  border-radius: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.tier-card-label {
  font-size: 0.85rem;
  opacity: 0.85;
}

.tier-card-value {
  font-weight: 700;
  font-size: 1.1rem;
}

/* ===============================
   TIER COLORS
   =============================== */
.tier-sss { color: #ff5e3a; text-shadow: 0 0 12px rgba(255,94,58,0.7); }
.tier-s  { color: #facc15; text-shadow: 0 0 10px rgba(250,204,21,0.6); }
.tier-a  { color: #fb923c; }
.tier-b  { color: #a855f7; }
.tier-c  { color: #38bdf8; }
.tier-d  { color: #9ca3af; }
.tier-none { opacity: 0.3; }
/* ===============================
   STAT BARS
   =============================== */

.stat-row {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.stat-right {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

/* Hintergrund */
.stat-bar {
  height: 6px;
  width: 100%;
  background: rgba(255,255,255,0.08);
  border-radius: 999px;
  overflow: hidden;
}

/* F√ºllung */
.stat-bar-fill {
  height: 100%;
  border-radius: inherit;
  background: linear-gradient(
    90deg,
    #facc15,
    #f59e0b
  );
  box-shadow: 0 0 10px rgba(250,204,21,0.6);
  transition: width 0.4s ease;
}
/* Rank 1 ‚Äì Gold */
.stat-bar-fill.rank-1 {
  background: linear-gradient(90deg, #facc15, #fde68a);
  box-shadow: 0 0 10px rgba(250,204,21,0.8);
}

/* Rank 2 ‚Äì Silber */
.stat-bar-fill.rank-2 {
  background: linear-gradient(90deg, #e5e7eb, #f9fafb);
}

/* Rank 3 ‚Äì Bronze */
.stat-bar-fill.rank-3 {
  background: linear-gradient(90deg, #f59e0b, #fcd34d);
}

/* Top 10 ‚Äì Blau/Violett */
.stat-bar-fill.rank-top {
  background: linear-gradient(90deg, #818cf8, #a5b4fc);
}

/* ===============================
   HERO DESCRIPTION
   =============================== */
.hero-description {
  max-width: 560px;

  margin: 0px 0 24px;
  padding: 0;

  font-size: 0.95rem;
  line-height: 1.55;

  color: rgba(230, 230, 235, 0.75);

  /* leichte visuelle Trennung */
  text-wrap: pretty;
}
  /* ===============================
   STAT HIGHLIGHTING
   =============================== */
.stat-max {
  margin-left: 6px;
  font-size: 0.7rem;
  opacity: 0.6;
  
}

.stat-value {
  display: flex;
  align-items: center;
  width: 100%;
  gap: 6px;
}

.stat-current {
  white-space: nowrap;
}

.stat-rank {
  margin-left: auto; /* üëà MAGIE */
  font-size: 0.7rem;
  opacity: 0.75;
}

/* Top 1 */
.stat-rank.rank-1 {
  color: #facc15;
  text-shadow: 0 0 6px rgba(250,204,21,0.8);
  font-weight: 700;
}

/* Top 2 */
.stat-rank.rank-2 {
  color: #e5e7eb;
  text-shadow: 0 0 6px rgba(229,231,235,0.7);
}

/* Top 3 */
.stat-rank.rank-3 {
  color: #f59e0b;
  text-shadow: 0 0 6px rgba(245,158,11,0.7);
}

/* Optional: Top 10 */
.stat-rank.rank-top {
  color: #a5b4fc;
}


  .identity-icons {
    height: 24px;
    width: 24px;
  }
  html,
  body {
    margin: 0;
    padding: 0;
    min-height: 100%;
    background:
      radial-gradient(
        ellipse at 30% -10%,
        rgba(120, 90, 200, 0.15),
        transparent 60%
      ),
      radial-gradient(
        ellipse at 80% 20%,
        rgba(255, 215, 100, 0.08),
        transparent 55%
      ),
      linear-gradient(to bottom, #0d0b10, #07060c);
    color: #e6e6eb;
    font-family:
      Spectral, ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji",
      "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
  }

  /* PAGE */
  .hero-detail-page {
    min-height: 100vh;
  }

  .rarity-stars {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .rarity-star {
    width: 24px;
    height: 24px;
    fill: #facc15;
    filter: drop-shadow(0 0 6px rgba(250, 204, 21, 0.6));
  }

  .rarity-label {
    margin-left: 8px;
    font-size: 0.85rem;
    font-weight: 500;
  }

  /* HEADER */
  .hero-detail-header {
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(10, 10, 16, 0.7);
    backdrop-filter: blur(16px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
  }

  .header-inner {
    max-width: 1200px;
    margin: 0 auto;
    padding: 18px 24px 14px;
  }

  .header-with-back {
    position: relative;
  }
  .identity-card h4 {
    -webkit-font-smoothing: antialiased;
    box-sizing: border-box;
    color: #ffffff;
    columns: auto;
    font-family:
      "Source Sans Pro", ui-sans-serif, system-ui, sans-serif,
      "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
      "Noto Color Emoji";
    font-size: 14px;
    font-weight: 700;
    line-height: 20px;
    text-align: center;
    text-transform: uppercase;
    text-wrap: nowrap;
    white-space: nowrap;
    margin: 0;
    padding: 0;
  }

  .identity-content span {
    -webkit-font-smoothing: antialiased;
    box-sizing: border-box;
    color: #ffffff;
    columns: auto;
    font-family:
      Spectral, ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji",
      "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
    font-size: 14px;
    line-height: 20px;
    padding: 0px 0px 0px;
    text-align: center;
    text-transform: capitalize;
    text-wrap: nowrap;
    white-space: nowrap;
  }

  .back-button {
    position: absolute;
    left: 24px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.7);
    text-decoration: none;
  }

  /* HEADER CENTER */
  .header-center {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
  }

  .hero-title {
    margin: 0;
    font-size: 1.9rem;
  }

  /* TABS */
  .hero-tabs {
    display: flex;
    gap: 26px;
  }

  .tab {
    background: none;
    border: none;
    color: rgba(255, 255, 255, 0.6);
  }

  .tab.active {
    color: #fff;
    border-bottom: 2px solid #facc15;
  }

  /* CONTENT */
  .hero-detail-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 56px 24px 80px;
  }

  /* OVERVIEW */
  .hero-overview {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 48px;
  }

  /* LARGE NAME */
  .hero-name-large {
    font-size: 72px;
    line-height: 1.05;
    font-weight: 600;
    padding: 48px 0 24px 0;
    margin:0;
  }

  /* FACTION */
  .hero-faction {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 18px;
  }

  /* IDENTITY CARDS */
  .hero-identity-cards {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 14px;
  }

  .identity-card {
    background-color: #00000040;
    border: 1px solid #ffffff33;
    border-radius: 12px;
    box-sizing: border-box;
    columns: auto;
    padding: 8px;
  }

  /* IMAGE HERO VISUAL */
.hero-visual {
  height: 420px;                 /* üëà HIER steuerst du die H√∂he */
  border-radius: 18px;

  background-size: cover;        /* ‚ùó schneidet zu, skaliert NICHT */
  background-position: center 30%; /* oder center / 50% 30% */
  background-repeat: no-repeat;

  overflow: hidden;
  /*
  box-shadow:
    0 18px 40px rgba(0,0,0,0.65),
    inset 0 0 0 1px rgba(255,255,255,0.06);*/
  }

  /* Faction Label */
  .faction-label {
    -webkit-font-smoothing: antialiased;
    box-sizing: border-box;
    color: #ffffff;
    columns: auto;
    font-family:
      Spectral, ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji",
      "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
    font-size: 24px;
    line-height: 32px;
  }
  .faction-icon {
    width: 48px;
    height: 48px;
  }

  /* STATS */
  .hero-stats {
    margin-top: 64px;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 14px;
  }

  .identity-content {
    align-items: center;
    border-radius: 12px;
    box-sizing: border-box;
    columns: auto;
    display: flex;
    gap: 4px;
    justify-content: center;
    padding: 8px;
  }
</style>

