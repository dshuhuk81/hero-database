---
import { heroes, getHeroById, statMaxima } from "../../data/heroes";
import SkillCard from "../../components/hero/SkillCard.astro";
import Footer from "../../components/Footer.astro";  
import RatingCard from "../../components/hero/RatingCard.astro";
import HeroCompositions from '../../components/HeroCompositions.astro';
import { computeScore } from "../../utils/rankingScore.js";
import { synergyProfileForHero, synergyPotentialForHero } from "../../utils/synergyTags.js";
import { rateHeroSkills } from "../../utils/skillAnalyzer.js";

const rankedHeroes = [...heroes]
  .map((hero) => {
    const s = hero.stats ?? {};
    return {
      hero,
      score: computeScore(hero),
      hp: Number(s.hp ?? 0),
      atk: Number(s.atk ?? 0),
      armor: Number(s.armor ?? 0),
      magicRes: Number(s.magicRes ?? 0),
    };
  })
  .sort((a, b) => b.score - a.score);

/* STATIC PATHS */
export function getStaticPaths() {
  return heroes.map((hero) => ({
    params: { id: hero.id },
  }));
}

const { id } = Astro.params;
const hero = getHeroById(id);

// Ranking Daten f√ºr diesen Hero
const currentHeroData = rankedHeroes.find(r => r.hero.id === id);
const currentRank = currentHeroData ? rankedHeroes.indexOf(currentHeroData) + 1 : null;

// Synergy & Skill Analysis
const synergyProfile = synergyProfileForHero(hero);
const synergyPotential = synergyPotentialForHero(hero);
const skillPower = rateHeroSkills(hero);

// Berechne Einzelstat-Rankings f√ºr Transparency
function getStatRanking(statKey) {
  const sorted = [...rankedHeroes].sort((a, b) => b[statKey] - a[statKey]);
  return sorted.findIndex(r => r.hero.id === id) + 1;
}

const statRankings = {
  hp: currentHeroData ? getStatRanking('hp') : null,
  atk: currentHeroData ? getStatRanking('atk') : null,
  armor: currentHeroData ? getStatRanking('armor') : null,
  magicRes: currentHeroData ? getStatRanking('magicRes') : null,
};

// ‚úÖ NEU: Mode aus Query ziehen (general|pve|pvp)
const mode = Astro.url.searchParams.get("mode") ?? "general";

const currentHero = await import(`../../data/heroes/${id}.json`);

if (!hero) {
  throw new Error(`Hero with id "${id}" not found`);
}

const PERCENT_STATS = new Set([
  "dodgeRate",
  "hitBonus",
  "critRate",
  "critRes",
  "critDmgBonus",
  "critDmgRed",
  "cooldownHaste",
  "atkSpdBonus",
  "pDmgBonus",
  "pDmgRed",
  "mDmgBonus",
  "mDmgRed",
  "healEff",
  "rechargeEff",
  "lifestealEff",
  "reflectEff",
  "effectRes",
  "effectHit",
  "controlRes",
  "controlBonus",
  "normalSkillPWR",
  "ultimatePWR"
]);

const STAT_LABELS = {
  might: "Might",
  hp: "HP",
  atk: "ATK",
  armor: "Armor",
  magicRes: "M-Res",
  dodgeRate: "Dodge",
  hitBonus: "Hit",
  critRate: "Crit Rate",
  critRes: "Crit RES",
  critDmgBonus: "Crit DMG",
  critDmgRed: "Crit Red",
  energy: "Energy",
  cooldownHaste: "Cooldown Haste",
  atkSpdBonus: "ATK SPD Bonus",
  pDmgBonus: "Physical DMG Bonus",
  pDmgRed: "Physical DMG Reduction",
  mDmgBonus: "Magical DMG Bonus",
  mDmgRed: "Magical DMG Reduction",
  healEff: "Heal Efficiency",
  rechargeEff: "Recharge Efficiency",
  lifestealEff: "Lifesteal Efficiency",
  reflectEff: "Reflect Efficiency",
  effectRes: "Effect Resistance",
  effectHit: "Effect Hit",
  controlRes: "Control Resistance",
  controlBonus: "Control Bonus",
  normalSkillPWR: "Normal Skill PWR",
  ultimatePWR: "Ultimate PWR"
};
---

<head>
  <meta charset="utf-8" />
</head>

<div class="hero-detail-page">
  <!-- STICKY HEADER -->
  <header class="hero-detail-header">
    <div class="header-inner header-with-back">
      <a href="/" class="back-button">‚Üê Back</a>

      <div class="header-center">
        <h1 class="hero-title">{hero.name}</h1>

        <nav class="hero-tabs">
          <button class="tab active" data-tab="attributes">Attributes</button>
          <button class="tab" data-tab="skills">Skills</button>
          <button class="tab" data-tab="synergies">Compositions<span class="alpha-chip">Alpha</span></button>
        </nav>
      </div>
    </div>
  </header>

  <!-- CONTENT -->
  <main class="hero-detail-content">
    <!-- TAB: ATTRIBUTES -->
    <div class="tab-content active" data-content="attributes">
      <section class="hero-overview">
        <!-- LEFT -->
        <div>
          <!-- LARGE HERO NAME -->
          <h2 class="hero-name-large">{hero.name}</h2>

          <!-- Description  -->
          {hero.description && (
            <p class="hero-description">
              {hero.description}
            </p>
          )}
          
          <!-- FACTION -->
          <div class="hero-faction">
            <img
              src={`/icons/factions/${hero.faction.toLowerCase()}.webp`}
              alt={hero.faction}
              class="faction-icon"
            />
            <span class="faction-label">{hero.faction}</span>
          </div>

          <!-- IDENTITY CARDS -->
          <div class="hero-identity-cards">
            <div class="identity-card">
              <h4>Class</h4>
              <div class="identity-content">
                <img
                  class="identity-icons"
                  src={`/icons/classes/${hero.class.toLowerCase()}.webp`}
                  alt={hero.class}
                />
                <span>{hero.class}</span>
              </div>
            </div>

            <div class="identity-card">
              <h4>Role</h4>
              <div class="identity-content">
                <img
                  class="identity-icons"
                  src={`/icons/roles/${hero.role.toLowerCase()}.webp`}
                  alt={hero.role}
                />
                <span>{hero.role}</span>
              </div>
            </div>

            <div class="identity-card">
              <h4>Rarity</h4>
              <div class="identity-content rarity-content">
                <svg class="rarity-star" viewBox="0 0 24 24" aria-hidden="true">
                  <path
                    d="M12 2l2.9 6.1 6.7.6-5 4.5 1.5 6.6L12 16.8 5.9 19.8 7.4 13.2 2.4 8.7l6.7-.6L12 2z"
                  ></path>
                </svg>
                <span>{hero.rarity}</span>
              </div>
            </div>

            <!-- üî• NEU: Relic Priority -->
            {hero.recommendedRelicLevel !== undefined && (
              <div class="identity-card">
                <h4>Relic Prio</h4>
                <div class="identity-content">
                  <span class={`relic-level relic-level-${hero.recommendedRelicLevel}`}>
                    Level {hero.recommendedRelicLevel}
                  </span>
                </div>
              </div>
            )}
          </div>
        </div>

        <!-- RIGHT -->
        <div class="hero-visual" style={`background-image: url(${hero.image});`}>
        </div>
      </section>

      <!-- STATS -->
      <section class="hero-stats">
        <div class="headline-with-info"><h2>Stats</h2><span>(Level {hero.level}, {hero.evolution})</span></div>

        <div class="stats-grid">
          {Object.entries(STAT_LABELS).map(([key, label]) => (
            <div class="stat-row">
              <span class="stat-label">{label}</span>

              <div class="stat-right">
                <span class="stat-value">
                  <span class="stat-current">
                    {hero.stats[key]}
                    <span class="stat-max"> / {statMaxima[key]}</span>
                  </span>

                  {hero.rankings?.[key] && (
                    <small class="stat-rank">
                      #{hero.rankings[key]}
                    </small>
                  )}
                </span>

                <!-- STAT BAR -->
                <div class="stat-bar">
                  <div
                    class={`stat-bar-fill ${
                      hero.rankings?.[key] === 1
                        ? "rank-1"
                        : hero.rankings?.[key] === 2
                        ? "rank-2"
                        : hero.rankings?.[key] === 3
                        ? "rank-3"
                        : hero.rankings?.[key] <= 10
                        ? "rank-top"
                        : "rank-default"
                    }`}
                    style={`width: ${
                      statMaxima[key]
                        ? Math.min((hero.stats[key] / statMaxima[key]) * 100, 100)
                        : 0
                    }%`}
                  />
                </div>
              </div>
            </div>
          ))}
        </div>
      </section>

      <!-- RANKINGS WIDGET -->
      {currentHeroData && (
        <section class="hero-rankings-widget">
          <div class="rankings-widget-title-row">
            <div  class="margin-btm-16"><h2>Global Ranking</h2>
            <div class="ranking-info-icon-wrapper" data-tooltip="Score = Base stats (HP/ATK/Armor/M-Res) + percent stats + synergy potential">
              <svg class="ranking-info-icon" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
                <text x="12" y="16" text-anchor="middle" font-size="14" font-weight="bold" fill="currentColor">?</text>
              </svg>
            </div></div>
          </div>
          <div class="rankings-widget-inner">
            <div class="rankings-widget-header">
              <div class="rankings-widget-rank-prominent">
                <span class="rankings-widget-rank-number">#{currentRank}</span>
                <span class="rankings-widget-rank-of">of {heroes.length}</span>
              </div>
              <div class="rankings-widget-score">
                <span class="rankings-widget-score-value">{Math.round(currentHeroData.score)}</span>
                <span class="rankings-widget-score-label">Score</span>
              </div>
            </div>
            
            <div class="rankings-widget-stats">
              <div class="ranking-widget-stat">
                <div class="stat-header">
                  <span class="ranking-stat-label">HP</span>
                  <span class="stat-rank-badge">#{statRankings.hp}</span>
                </div>
                <span class="ranking-stat-val">{currentHeroData.hp.toLocaleString("en-US")}</span>
              </div>
              <div class="ranking-widget-stat">
                <div class="stat-header">
                  <span class="ranking-stat-label">ATK</span>
                  <span class="stat-rank-badge">#{statRankings.atk}</span>
                </div>
                <span class="ranking-stat-val">{currentHeroData.atk.toLocaleString("en-US")}</span>
              </div>
              <div class="ranking-widget-stat">
                <div class="stat-header">
                  <span class="ranking-stat-label">Armor</span>
                  <span class="stat-rank-badge">#{statRankings.armor}</span>
                </div>
                <span class="ranking-stat-val">{currentHeroData.armor.toLocaleString("en-US")}</span>
              </div>
              <div class="ranking-widget-stat">
                <div class="stat-header">
                  <span class="ranking-stat-label">M-Res</span>
                  <span class="stat-rank-badge">#{statRankings.magicRes}</span>
                </div>
                <span class="ranking-stat-val">{currentHeroData.magicRes.toLocaleString("en-US")}</span>
              </div>
            </div>

            <!-- SYNERGIES & SKILLS SECTION -->
            <div class="rankings-widget-advanced">
              <!-- Skill Power -->
              <div class="ranking-advanced-block">
                <h4 class="ranking-advanced-title">
                  <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                  </svg>
                  Skill Power
                </h4>
                <div class="skill-power-meter">
                  <div class="skill-power-bar">
                    <div 
                      class="skill-power-fill" 
                      style={`width: ${Math.min((skillPower / 3) * 100, 100)}%`}
                    />
                  </div>
                  <div class="skill-power-stats">
                    <span class="skill-power-value">{skillPower.toFixed(2)}</span>
                    <span class="skill-power-label">/ 3.0</span>
                  </div>
                </div>
                <p class="skill-power-desc">
                  Based on damage multipliers, AoE, CC effects, and utility
                </p>
              </div>

              <!-- Synergies -->
              <div class="ranking-advanced-block">
                <h4 class="ranking-advanced-title">
                  <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                  </svg>
                  Team Synergies
                  <span class="synergy-potential-badge">{synergyPotential}</span>
                </h4>
                {synergyProfile.tags.size === 0 ? (
                  <p class="no-synergies">No team synergies detected</p>
                ) : (
                  <div class="synergy-tags">
                    {Array.from(synergyProfile.tags).map((tag) => (
                      <span class="synergy-tag" data-synergy={tag}>
                        {tag.replace(/_/g, ' ')}
                      </span>
                    ))}
                  </div>
                )}
              </div>
            </div>
          </div>
        </section>
      )}

      <!-- RATINGS -->
      {hero.ratings && (
        <RatingCard ratings={hero.ratings} />
      )}

      
    </div>

    <!-- TAB: SKILLS -->
    <div class="tab-content" data-content="skills">
      <section class="hero-skills">
        <h2>Skills</h2>
        
        <!-- Skills -->
        <div class="skills-container">
          {hero.skills && hero.skills.map((skill, index) => (
            <SkillCard
              name={skill.name}
              icon={skill.image || `/skills/${hero.id}_skill_${index + 1}.webp`}
              description={skill.description}
              upgrades={skill.upgrades}
              type={`Skill ${index + 1}`}
              stars={3}
              showGrid={true}
            />
          ))}

          <!-- Relic -->
          {hero.relic && (
            <SkillCard
              name={hero.relic.name}
              icon={hero.relic.image || `/skills/${hero.id}_relic.webp`}
              description={hero.relic.description}
              upgrades={hero.relic.upgrades}
              type="Relic"
              stars={0}
              showGrid={false}
            />
          )}
        </div>
      </section>
    </div>

    <!-- TAB: COMPOSITIONS -->
    <div class="tab-content" data-content="synergies">
      <div class="comp-toolbar">
        <label for="compMode" class="comp-toolbar-label">Mode</label>
        <select id="compMode" class="comp-toolbar-select">
          <option value="general">General</option>
          <option value="pve">PvE</option>
          <option value="pvp">PvP</option>
        </select>
      </div>

      <div class="comp-modes">
        <div class="comp-mode" data-mode="general">
          <HeroCompositions heroId={id} mode="general" />
        </div>

        <div class="comp-mode" data-mode="pve" style="display:none">
          <HeroCompositions heroId={id} mode="pve" />
        </div>

        <div class="comp-mode" data-mode="pvp" style="display:none">
          <HeroCompositions heroId={id} mode="pvp" />
        </div>
      </div>
    </div>
  </main>

  <Footer />
</div>

<style>
.headline-with-info {
  display: flex;
  align-items: first baseline;
  gap: 12px;
  margin-bottom: 0.5rem;
}
.alpha-chip {
  position: absolute;
  top:-6px;
  right: -10px;
  font-size: 8px;
  color: white;
  background-color: red;
  border-radius: 4px;
  padding: 2px 4px;
}
  .comp-toolbar{
  display:flex;
  align-items:center;
  gap:.75rem;
  margin: 0 0 1rem 0;
}
.comp-toolbar-label{
  opacity:.85;
  font-size:.9rem;
}
.comp-toolbar-select{
  padding:.4rem .6rem;
  border-radius:10px;
  background: rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.12);
  color: inherit;
}
  /* ‚úÖ NEW: Mode bar styling */
  .comp-mode-bar{
    display:flex;
    gap:.75rem;
    align-items:center;
    margin: 0 0 1rem 0;
    padding: .75rem 1rem;
    border: 1px solid rgba(255,255,255,.08);
    border-radius: 12px;
    background: rgba(0,0,0,.18);
  }
  .comp-mode-bar label{
    font-weight: 700;
    opacity: .9;
  }
  .comp-mode-bar select{
    background: rgba(255,255,255,.06);
    border: 1px solid rgba(255,255,255,.12);
    color: #e6e6eb;
    padding: .4rem .6rem;
    border-radius: 10px;
    outline: none;
  }

  /* ===============================
     TAB CONTENT
     =============================== */
  .tab-content {
    display: none;
  }

  .tab-content.active {
    display: block;
  }

  /* ===============================
     STAT BARS
     =============================== */

  .stat-row {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
.margin-btm-16 {
  margin-bottom: 16px!important;
  display: flex;
  gap: 12px;
}
  .stat-right {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  /* Hintergrund */
  .stat-bar {
    height: 6px;
    width: 100%;
    background: rgba(255, 255, 255, 0.08);
    border-radius: 999px;
    overflow: hidden;
  }

  /* F√ºllung */
  .stat-bar-fill {
    height: 100%;
    border-radius: inherit;
    background: linear-gradient(90deg, #facc15, #f59e0b);
    box-shadow: 0 0 10px rgba(250, 204, 21, 0.6);
    transition: width 0.4s ease;
  }
  
  /* Rank 1 ‚Äì Gold */
  .stat-bar-fill.rank-1 {
    background: linear-gradient(90deg, #facc15, #fde68a);
    box-shadow: 0 0 10px rgba(250, 204, 21, 0.8);
  }

  /* Rank 2 ‚Äì Silber */
  .stat-bar-fill.rank-2 {
    background: linear-gradient(90deg, #e5e7eb, #f9fafb);
  }

  /* Rank 3 ‚Äì Bronze */
  .stat-bar-fill.rank-3 {
    background: linear-gradient(90deg, #f59e0b, #fcd34d);
  }

  /* Top 10 ‚Äì Blau/Violett */
  .stat-bar-fill.rank-top {
    background: linear-gradient(90deg, #818cf8, #a5b4fc);
  }

  /* ===============================
     HERO DESCRIPTION
     =============================== */
  .hero-description {
    max-width: 560px;
    margin: 0px 0 24px;
    padding: 0;
    font-size: 0.95rem;
    line-height: 1.55;
    color: rgba(230, 230, 235, 0.75);
    text-wrap: pretty;
  }
  
  /* ===============================
     STAT HIGHLIGHTING
     =============================== */
  .stat-max {
    margin-left: 6px;
    font-size: 0.7rem;
    opacity: 0.6;
  }

  .stat-value {
    display: flex;
    align-items: center;
    width: 100%;
    gap: 6px;
  }

  .stat-current {
    white-space: nowrap;
  }

  .stat-rank {
    margin-left: auto;
    font-size: 0.7rem;
    opacity: 0.75;
  }

  /* Top 1 */
  .stat-rank.rank-1 {
    color: #facc15;
    text-shadow: 0 0 6px rgba(250, 204, 21, 0.8);
    font-weight: 700;
  }

  /* Top 2 */
  .stat-rank.rank-2 {
    color: #e5e7eb;
    text-shadow: 0 0 6px rgba(229, 231, 235, 0.7);
  }

  /* Top 3 */
  .stat-rank.rank-3 {
    color: #f59e0b;
    text-shadow: 0 0 6px rgba(245, 158, 11, 0.7);
  }

  /* Optional: Top 10 */
  .stat-rank.rank-top {
    color: #a5b4fc;
  }

  .identity-icons {
    height: 24px;
    width: 24px;
  }
  
  html,
  body {
    margin: 0;
    padding: 0;
    min-height: 100%;
    background: radial-gradient(
        ellipse at 30% -10%,
        rgba(120, 90, 200, 0.15),
        transparent 60%
      ),
      radial-gradient(
        ellipse at 80% 20%,
        rgba(255, 215, 100, 0.08),
        transparent 55%
      ),
      linear-gradient(to bottom, #0d0b10, #07060c);
    color: #e6e6eb;
    font-family: Spectral, ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji",
      "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
  }

  /* PAGE */
  .hero-detail-page {
    min-height: 100vh;
  }

  .rarity-stars {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .rarity-star {
    width: 24px;
    height: 24px;
    fill: #facc15;
    filter: drop-shadow(0 0 6px rgba(250, 204, 21, 0.6));
  }

  .rarity-label {
    margin-left: 8px;
    font-size: 0.85rem;
    font-weight: 500;
  }

  /* HEADER */
  .hero-detail-header {
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(10, 10, 16, 0.7);
    backdrop-filter: blur(16px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
  }

  .header-inner {
    max-width: 1200px;
    margin: 0 auto;
    padding: 18px 24px 14px;
  }

  .header-with-back {
    position: relative;
  }
  
  .identity-card h4 {
    -webkit-font-smoothing: antialiased;
    box-sizing: border-box;
    color: #ffffff;
    columns: auto;
    font-family: "Source Sans Pro", ui-sans-serif, system-ui, sans-serif,
      "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
      "Noto Color Emoji";
    font-size: 14px;
    font-weight: 700;
    line-height: 20px;
    text-align: center;
    text-transform: uppercase;
    text-wrap: nowrap;
    white-space: nowrap;
    margin: 0;
    padding: 0;
  }

  .identity-content span {
    -webkit-font-smoothing: antialiased;
    box-sizing: border-box;
    color: #ffffff;
    columns: auto;
    font-family: Spectral, ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji",
      "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
    font-size: 14px;
    line-height: 20px;
    padding: 0px 0px 0px;
    text-align: center;
    text-transform: capitalize;
    text-wrap: nowrap;
    white-space: nowrap;
  }

  .back-button {
    position: absolute;
    left: 24px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.7);
    text-decoration: none;
  }

  /* HEADER CENTER */
  .header-center {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
  }

  .hero-title {
    margin: 0;
    font-size: 1.9rem;
  }

  /* TABS */
  .hero-tabs {
    display: flex;
    gap: 26px;
  }

  .tab {
    background: none;
    border: none;
    color: rgba(255, 255, 255, 0.6);
    cursor: pointer;
    padding: 8px 12px;
    font-size: 1rem;
    transition: all 0.2s ease;
    position: relative;
  }

  .tab.active {
    color: #fff;
    border-bottom: 2px solid #facc15;
  }

  /* CONTENT */
  .hero-detail-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 56px 24px 80px;
  }

  /* OVERVIEW */
  .hero-overview {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 48px;
  }

  /* LARGE NAME */
  .hero-name-large {
    font-size: 72px;
    line-height: 1.05;
    font-weight: 600;
    padding: 48px 0 24px 0;
    margin: 0;
  }

  /* FACTION */
  .hero-faction {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 18px;
  }

  /* IDENTITY CARDS */
  .hero-identity-cards {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 14px;
  }

  .identity-card {
    background-color: #00000040;
    border: 1px solid #ffffff33;
    border-radius: 12px;
    box-sizing: border-box;
    columns: auto;
    padding: 8px;
  }

  /* IMAGE HERO VISUAL */
  .hero-visual {
    height: 420px;
    border-radius: 18px;
    background-size: cover;
    background-position: center 30%;
    background-repeat: no-repeat;
    overflow: hidden;
  }

  /* Faction Label */
  .faction-label {
    -webkit-font-smoothing: antialiased;
    box-sizing: border-box;
    color: #ffffff;
    columns: auto;
    font-family: Spectral, ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji",
      "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
    font-size: 24px;
    line-height: 32px;
  }
  
  .faction-icon {
    width: 48px;
    height: 48px;
  }

  /* STATS */
  .hero-stats {
    margin-top: 64px;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 14px;
  }

  .identity-content {
    align-items: center;
    border-radius: 12px;
    box-sizing: border-box;
    columns: auto;
    display: flex;
    gap: 4px;
    justify-content: center;
    padding: 8px;
  }

  /* ===============================
     üî• RELIC LEVEL STYLING - VERBESSERT
     =============================== */
  .relic-level {
    font-weight: 700;
    padding: 8px 16px;
    border-radius: 8px;
    font-size: 0.8rem;
    text-transform: none;
    letter-spacing: 0.3px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    display: inline-block;
    min-width: 80px;
    text-align: center;
  }

  .relic-level-30 {
    background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
    color: #1a1a1a;
    font-weight: 800;
    box-shadow: 
      0 0 12px rgba(251, 191, 36, 0.6), 
      0 2px 8px rgba(0, 0, 0, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.3);
    border: 1px solid rgba(245, 158, 11, 0.8);
  }

  .relic-level-20 {
    background: linear-gradient(135deg, #818cf8 0%, #6366f1 100%);
    color: #ffffff;
    box-shadow: 
      0 0 10px rgba(129, 140, 248, 0.5),
      0 2px 8px rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(99, 102, 241, 0.6);
  }

  .relic-level-10 {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: #ffffff;
    box-shadow: 
      0 0 8px rgba(16, 185, 129, 0.5),
      0 2px 8px rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(5, 150, 105, 0.6);
  }

  .relic-level-1 {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.1) 100%);
    color: rgba(255, 255, 255, 0.9);
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
  }

  .relic-level-0 {
    background: rgba(255, 255, 255, 0.05);
    color: rgba(255, 255, 255, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
  }

  .identity-card:has(.relic-level) {
    transition: transform 0.2s ease;
  }

  .identity-card:has(.relic-level):hover {
    transform: translateY(-2px);
  }

  .identity-card:has(.relic-level-30):hover {
    box-shadow: 0 4px 16px rgba(251, 191, 36, 0.3);
  }

  .identity-card:has(.relic-level-20):hover {
    box-shadow: 0 4px 16px rgba(129, 140, 248, 0.3);
  }

  .identity-card:has(.relic-level-10):hover {
    box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);
  }

  /* SKILLS SECTION */
  .hero-skills {
    margin-top: 24px;
  }

  .hero-skills h2 {
    margin-bottom: 1.5rem;
  }

  .skills-container {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
  }

  @media (max-width: 1200px) {
    .skills-container {
      gap: 0.75rem;
    }
    
    .hero-identity-cards {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 768px) {
    .skills-container {
      flex-direction: column;
    }
    
    .hero-overview {
      grid-template-columns: 1fr;
    }
    
    .hero-name-large {
      font-size: 48px;
    }
  }

  /* POWER INDEX SECTION */
  .power-index-section {
    margin-top: 32px;
    padding: 24px;
    background: rgba(120, 90, 200, 0.08);
    border: 1px solid rgba(120, 90, 200, 0.2);
    border-radius: 12px;
  }

  .power-index-subtitle {
    margin: 0;
    opacity: 0.7;
    font-size: 0.9rem;
  }

  .normalization-badge {
    margin: 8px 0 0;
    padding: 8px 12px;
    background: rgba(100, 200, 150, 0.15);
    border-left: 3px solid rgba(100, 200, 150, 0.5);
    border-radius: 4px;
    font-size: 0.85rem;
    color: #66c8a0;
    font-weight: 500;
  }

  .power-index-header {
    margin-bottom: 20px;
  }

  .power-index-card {
    display: grid;
    grid-template-columns: 140px 1fr;
    gap: 20px;
    align-items: center;
  }

  .power-index-score {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .score-circle {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(120, 90, 200, 0.2));
    border: 2px solid rgba(255, 215, 0, 0.4);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 4px;
  }

  .score-value {
    font-size: 2.2rem;
    font-weight: 700;
    color: #ffd700;
  }

  .score-max {
    font-size: 0.85rem;
    opacity: 0.8;
  }

  .tier-info {
    display: flex;
    align-items: center;
    gap: 8px;
    justify-content: center;
  }

  .tier-label {
    font-size: 0.9rem;
    opacity: 0.7;
  }

  .tier-badge {
    background: rgba(255, 215, 0, 0.2);
    border: 1px solid rgba(255, 215, 0, 0.4);
    color: #ffd700;
    padding: 4px 12px;
    border-radius: 6px;
    font-weight: 600;
    font-size: 0.95rem;
  }

  .tier-badge[data-tier="SSS"],
  .tier-badge[data-tier="SS"] {
    background: rgba(255, 100, 100, 0.15);
    border-color: rgba(255, 100, 100, 0.3);
    color: #ff9999;
  }

  .tier-badge[data-tier="S"] {
    background: rgba(100, 200, 255, 0.15);
    border-color: rgba(100, 200, 255, 0.3);
    color: #66c0ff;
  }

  .power-index-breakdown {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
  }

  .breakdown-box {
    background: rgba(0, 0, 0, 0.2);
    padding: 16px;
    border-radius: 8px;
    border: 1px solid rgba(120, 90, 200, 0.15);
  }

  .breakdown-box h4 {
    margin: 0 0 12px;
    font-size: 0.95rem;
    color: #ffd700;
    font-weight: 600;
  }

  .breakdown-value {
    font-size: 1.4rem;
    font-weight: 700;
    color: #b4e7ff;
    margin-bottom: 12px;
  }

  .breakdown-max {
    font-size: 0.85rem;
    opacity: 0.7;
    margin-left: 4px;
    font-weight: 500;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
  }

  .stat-item {
    background: rgba(60, 50, 85, 0.3);
    padding: 8px;
    border-radius: 6px;
    display: flex;
    justify-content: space-between;
    font-size: 0.85rem;
  }

  .stat-name {
    opacity: 0.8;
  }

  .stat-score {
    font-weight: 600;
    color: #ffd700;
  }

  .signals-list {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  .signal-tag {
    display: inline-block;
    background: rgba(120, 90, 200, 0.3);
    border: 1px solid rgba(120, 90, 200, 0.5);
    padding: 4px 10px;
    border-radius: 14px;
    font-size: 0.8rem;
    color: #b4e7ff;
    font-weight: 500;
  }

  .no-signals {
    margin: 0;
    opacity: 0.6;
    font-size: 0.85rem;
  }

  /* ‚îÄ‚îÄ‚îÄ RANKINGS WIDGET ‚îÄ‚îÄ‚îÄ */
  .hero-rankings-widget {
    margin-top: 40px;
  }

  .rankings-widget-title-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
  }

  .hero-rankings-widget h2 {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 600;
  }

  .ranking-info-icon-wrapper {
    position: relative;
    display: inline-flex;
    align-items: center;
    cursor: help;
  }

  .ranking-info-icon {
    width: 20px;
    height: 20px;
    opacity: 0.6;
    flex-shrink: 0;
    transition: opacity 0.2s ease;
  }

  .ranking-info-icon-wrapper:hover .ranking-info-icon {
    opacity: 1;
  }

  /* Tooltip */
  .ranking-info-icon-wrapper::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: calc(100% + 12px);
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.9);
    color: #e6e6eb;
    padding: 10px 14px;
    border-radius: 8px;
    font-size: 0.8rem;
    font-weight: 500;
    line-height: 1.4;
    white-space: nowrap;
    pointer-events: none;
    opacity: 0;
    visibility: hidden;
    transition: all 0.2s ease;
    z-index: 1000;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  }

  .ranking-info-icon-wrapper:hover::after {
    opacity: 1;
    visibility: visible;
    bottom: calc(100% + 8px);
  }

  /* Tooltip arrow */
  .ranking-info-icon-wrapper::before {
    content: '';
    position: absolute;
    bottom: calc(100% + 2px);
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-top: 6px solid rgba(0, 0, 0, 0.9);
    opacity: 0;
    visibility: hidden;
    transition: all 0.2s ease;
    pointer-events: none;
    z-index: 1000;
  }

  .ranking-info-icon-wrapper:hover::before {
    opacity: 1;
    visibility: visible;
  }

  .rankings-widget-subtitle {
    margin: 0 0 16px;
    font-size: 0.85rem;
    opacity: 0.7;
    line-height: 1.4;
  }

  .rankings-widget-inner {
    background: rgba(120, 90, 200, 0.08);
    border: 1px solid rgba(168, 85, 247, 0.2);
    border-radius: 12px;
    padding: 20px;
  }

  .rankings-widget-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .rankings-widget-rank-prominent {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 2px;
  }

  .rankings-widget-rank-number {
    font-size: 2.8rem;
    font-weight: 800;
    line-height: 1.2;
    background: linear-gradient(90deg, #a78bfa, #e879f9);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .rankings-widget-rank-of {
    font-size: 0.8rem;
    opacity: 0.6;
    font-weight: 600;
  }

  .rankings-widget-score {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 4px;
  }

  .rankings-widget-score-value {
    font-size: 2rem;
    font-weight: 800;
    background: linear-gradient(90deg, #facc15, #fbbf24);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .rankings-widget-score-label {
    font-size: 0.75rem;
    opacity: 0.6;
    text-transform: uppercase;
    letter-spacing: 0.03em;
    font-weight: 600;
  }

  .rankings-widget-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
  }

  .ranking-widget-stat {
    display: flex;
    flex-direction: column;
    gap: 6px;
    padding: 12px;
    background: rgba(255, 255, 255, 0.04);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 8px;
  }

  .stat-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .stat-rank-badge {
    display: inline-block;
    padding: 2px 8px;
    background: rgba(168, 85, 247, 0.2);
    border: 1px solid rgba(168, 85, 247, 0.3);
    border-radius: 6px;
    font-size: 0.7rem;
    font-weight: 700;
    color: #a78bfa;
    text-transform: uppercase;
    letter-spacing: 0.02em;
  }

  .ranking-stat-label {
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.6);
    text-transform: uppercase;
    letter-spacing: 0.02em;
    font-weight: 600;
  }

  .ranking-stat-val {
    font-size: 1.1rem;
    font-weight: 700;
    color: #60a5fa;
    font-variant-numeric: tabular-nums;
  }

  .rankings-widget-advanced {
    margin-top: 20px;
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .ranking-advanced-block {
    padding: 16px;
    background: rgba(120, 90, 200, 0.08);
    border: 1px solid rgba(168, 85, 247, 0.15);
    border-radius: 12px;
  }

  .ranking-advanced-block h4 {
    display: flex;
    align-items: center;
    gap: 8px;
    margin: 0 0 12px 0;
    font-size: 0.85rem;
    font-weight: 700;
    color: rgba(255, 255, 255, 0.8);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .section-icon {
    width: 16px;
    height: 16px;
    opacity: 0.7;
  }

  .skill-power-meter {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .skill-power-bar {
    height: 24px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 6px;
    overflow: hidden;
    position: relative;
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .skill-power-fill {
    height: 100%;
    background: linear-gradient(90deg, #a78bfa, #c084fc);
    border-radius: 6px;
    transition: width 0.3s ease;
    box-shadow: 0 0 10px rgba(167, 139, 250, 0.4);
  }

  .skill-power-stats {
    display: flex;
    gap: 6px;
    align-items: baseline;
    margin-top: 4px;
  }

  .skill-power-value {
    font-size: 1.2rem;
    font-weight: 800;
    color: #c084fc;
    font-variant-numeric: tabular-nums;
  }

  .skill-power-label {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.5);
    font-weight: 600;
  }

  .skill-power-desc {
    margin: 8px 0 0 0;
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.5);
    font-style: italic;
  }

  .no-synergies {
    margin: 8px 0 0 0;
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.4);
    font-style: italic;
  }

  .synergy-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    align-items: center;
  }

  .synergy-tag {
    display: inline-flex;
    align-items: center;
    padding: 6px 12px;
    background: rgba(59, 130, 246, 0.15);
    border: 1px solid rgba(59, 130, 246, 0.3);
    border-radius: 8px;
    font-size: 0.75rem;
    font-weight: 700;
    color: #60a5fa;
    text-transform: uppercase;
    letter-spacing: 0.03em;
    transition: all 0.2s ease;
  }

  .synergy-tag:hover {
    background: rgba(59, 130, 246, 0.25);
    border-color: rgba(59, 130, 246, 0.5);
    transform: translateY(-1px);
  }

  .synergy-potential-badge {
    display: inline-flex;
    align-items: center;
    padding: 6px 12px;
    background: rgba(251, 191, 36, 0.15);
    border: 1px solid rgba(251, 191, 36, 0.3);
    border-radius: 8px;
    font-size: 0.75rem;
    font-weight: 700;
    color: #fbbf24;
    text-transform: uppercase;
    letter-spacing: 0.03em;
  }

  @media (max-width: 768px) {
    .rankings-widget-inner {
      padding: 16px;
    }

    .rankings-widget-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 12px;
    }

    .rankings-widget-score {
      align-items: flex-start;
    }

    .rankings-widget-score-value {
      font-size: 1.6rem;
    }

    .rankings-widget-stats {
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }

    .ranking-widget-stat {
      padding: 10px;
    }

    .ranking-stat-val {
      font-size: 0.95rem;
    }

    .rankings-widget-advanced {
      gap: 12px;
    }

    .ranking-advanced-block {
      padding: 12px;
    }

    .ranking-advanced-block h4 {
      font-size: 0.8rem;
    }

    .synergy-tags {
      gap: 6px;
    }

    .synergy-tag {
      padding: 5px 10px;
      font-size: 0.7rem;
    }

    .synergy-potential-badge {
      padding: 5px 10px;
      font-size: 0.7rem;
    }

    .skill-power-bar {
      height: 20px;
    }

    /* Mobile Tooltip Anpassung */
    .ranking-info-icon-wrapper::after {
      white-space: normal;
      max-width: 200px;
      bottom: auto;
      top: calc(100% + 12px);
    }

    .ranking-info-icon-wrapper:hover::after {
      bottom: auto;
      top: calc(100% + 8px);
    }

    .ranking-info-icon-wrapper::before {
      bottom: auto;
      top: calc(100% + 2px);
      border-left: 5px solid transparent;
      border-right: 5px solid transparent;
      border-top: 5px solid rgba(0, 0, 0, 0.9);
    }
  }

</style>

<script>
  // ‚úÖ Hash-based Tab Switching (survives reloads)
  const tabs = document.querySelectorAll('.tab');
  const contents = document.querySelectorAll('.tab-content');

  function setActiveTab(target) {
    if (!target) return;

    tabs.forEach(t => t.classList.remove('active'));
    contents.forEach(c => c.classList.remove('active'));

    const btn = document.querySelector(`.tab[data-tab="${target}"]`);
    const panel = document.querySelector(`.tab-content[data-content="${target}"]`);

    if (btn) btn.classList.add('active');
    if (panel) panel.classList.add('active');
  }

  // On load: use hash if present
  const initial = (location.hash || '').replace('#', '');
  if (initial) setActiveTab(initial);

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const target = tab.getAttribute('data-tab');
      // persist in URL
      if (target) location.hash = target;
      setActiveTab(target);
    });
  });

  // ‚úÖ Mode Select: navigate to ?mode=...#synergies (keeps correct tab)
  const sel = document.getElementById('compMode');
  if (sel) {
    sel.addEventListener('change', () => {
      const url = new URL(window.location.href);
      url.searchParams.set('mode', sel.value);
      url.hash = 'synergies';
      window.location.href = url.toString();
    });
  }
  
  // --- Composition Mode Switching (no reload) ---
  const modeSelect = document.getElementById("compMode");
  const modePanels = document.querySelectorAll(".comp-mode[data-mode]");

  function setMode(mode) {
    modePanels.forEach(p => {
      p.style.display = (p.getAttribute("data-mode") === mode) ? "block" : "none";
    });
    if (modeSelect) modeSelect.value = mode;

    // persist without reload
    try { localStorage.setItem("heroCompMode", mode); } catch {}
  }

  // initial mode (localStorage -> fallback general)
  let initialMode = "general";
  try {
    const saved = localStorage.getItem("heroCompMode");
    if (saved && ["general","pve","pvp"].includes(saved)) initialMode = saved;
  } catch {}

  setMode(initialMode);

  if (modeSelect) {
    modeSelect.addEventListener("change", (e) => {
      const v = e.target.value;
      if (["general","pve","pvp"].includes(v)) setMode(v);
    });
  }

</script>