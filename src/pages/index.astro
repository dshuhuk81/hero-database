---
import HeroCard from "../components/HeroCard.astro";
import { heroes } from "../data/heroes";
---

<!-- HERO HEADER -->
<section class="hero-header"></section>

<h1 class="title">Choose your hero</h1>

<div class="content-wrapper">
  <section class="filters">

    <!-- CLASS FILTER -->
    <div class="filter-group">
      <span class="filter-label">Class</span>

      <button class="chip class-chip" data-class="tank" title="Tank">
        <img src="/icons/classes/tank.webp" alt="Tank" />
      </button>

      <button class="chip class-chip" data-class="warrior" title="Warrior">
        <img src="/icons/classes/warrior.webp" alt="Warrior" />
      </button>

      <button class="chip class-chip" data-class="archer" title="Archer">
        <img src="/icons/classes/archer.webp" alt="Archer" />
      </button>

      <button class="chip class-chip" data-class="mage" title="Mage">
        <img src="/icons/classes/mage.webp" alt="Mage" />
      </button>
      
      <button class="chip class-chip" data-class="support" title="Support">
        <img src="/icons/classes/support.webp" alt="Support" />
      </button>
            
      <button class="chip class-chip" data-class="assassin" title="Assassin">
        <img src="/icons/classes/assassin.webp" alt="Assassin" />
      </button>
    </div>
    
    <!-- ROLE FILTER -->
    <div class="filter-group">
      <span class="filter-label">Role</span>

      <button class="chip role-chip" data-role="nimble" title="Nimble">
        <img src="/icons/roles/nimble.webp" alt="Nimble" />
      </button>

      <button class="chip role-chip" data-role="arcane" title="Arcane">
        <img src="/icons/roles/arcane.webp" alt="Arcane" />
      </button>

      <button class="chip role-chip" data-role="hefty" title="Hefty">
        <img src="/icons/roles/hefty.webp" alt="Hefty" />
      </button>
    </div>

    <!-- SEARCH -->
    <div class="filter-group">
      <input
        type="text"
        id="searchInput"
        placeholder="Search hero..."
        class="search-input"
      />
    </div>

    <!-- RARITY FILTER -->
    <div class="filter-group">
      <span class="filter-label">Rarity</span>

      <button class="chip rarity-chip common" data-rarity="common" title="Common">
        <svg viewBox="0 0 24 24" class="rarity-star">
          <path d="M12 2l2.9 6.1 6.7.6-5 4.5 1.5 6.6L12 16.8 5.9 19.8 7.4 13.2 2.4 8.7l6.7-.6L12 2z"/>
        </svg>
      </button>

      <button class="chip rarity-chip epic" data-rarity="epic" title="Epic">
        <svg viewBox="0 0 24 24" class="rarity-star">
          <path d="M12 2l2.9 6.1 6.7.6-5 4.5 1.5 6.6L12 16.8 5.9 19.8 7.4 13.2 2.4 8.7l6.7-.6L12 2z"/>
        </svg>
      </button>

      <button class="chip rarity-chip legendary" data-rarity="legendary" title="Legendary">
        <svg viewBox="0 0 24 24" class="rarity-star">
          <path d="M12 2l2.9 6.1 6.7.6-5 4.5 1.5 6.6L12 16.8 5.9 19.8 7.4 13.2 2.4 8.7l6.7-.6L12 2z"/>
        </svg>
      </button>
    </div>

    <!-- RESET -->
    <div class="filter-group">
      <button id="resetFilters" class="reset-button">Reset Filters</button>
    </div>

  </section>


<!-- RESULTS -->
<div class="resultcontent">
  <p id="heroCounter" class="hero-counter">0 Heroes shown</p>

  <div class="grid" id="heroGrid">
    {heroes.map(hero => (
      <div
        class={`hero-wrapper rarity-${(hero.rarity ?? "").toLowerCase()}`}
        data-name={(hero.name ?? "").toLowerCase()}
        data-class={(hero.class ?? "").toLowerCase()}
        data-role={(hero.role ?? "").toLowerCase()}
        data-rarity={(hero.rarity ?? "").toLowerCase()}
      >

        <!-- ICON STACK -->
        <div class="icon-stack">
          <img src={`/icons/factions/${hero.faction.toLowerCase()}.webp`} alt={hero.faction} />
          <img src={`/icons/roles/${hero.role.toLowerCase()}.webp`} alt={hero.role} />
          <img src={`/icons/classes/${hero.class.toLowerCase()}.webp`} alt={hero.class} />
        </div>

        <HeroCard hero={hero} />
      </div>
    ))}
  </div>
</div>
</div>

<style>
/* RESET & BASE */
html, body {
  margin: 0;
  padding: 0;
  font-family: "Spectral", "Roboto", system-ui, sans-serif;
  background:
    radial-gradient(ellipse at 30% -10%, rgba(120,90,200,0.15), transparent 60%),
    radial-gradient(ellipse at 80% 20%, rgba(255,215,100,0.08), transparent 55%),
    linear-gradient(to bottom, #0d0b10, #07060c);
  color: #e6e6eb;
}

/* HERO HEADER */
.hero-header {
  height: 360px;
  background: url("/bg.jpg") center / cover fixed;
  position: relative;
}
.hero-header::after {
  content: "";
  position: absolute;
  inset: 0;
  background:
    radial-gradient(ellipse at center, rgba(0,0,0,0) 40%, rgba(0,0,0,0.35)),
    linear-gradient(to bottom, rgba(0,0,0,0.1), rgba(0,0,0,0.45));
}

/* TITLE */
.title {
  text-align: center;
  margin: 32px 0;
  font-weight: 600;
}

/* FILTERS */
.content-wrapper {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 16px;
}

.filters {
  display: flex;
  justify-content: center;
  align-items: center;
  flex-wrap: wrap;
  gap: 24px;

  background:
    linear-gradient(
      to bottom,
      rgba(35, 32, 48, 0.85),
      rgba(18, 16, 26, 0.95)
    );

  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);

  padding: 18px 28px;
  border-radius: 18px;

  box-shadow:
    inset 0 1px 0 rgba(255,255,255,0.08),
    inset 0 -1px 0 rgba(0,0,0,0.6),
    0 20px 50px rgba(0,0,0,0.75);
}

.filter-group {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 16px;
}
.filter-label {
  font-weight: 600;
  opacity: 0.85;

}
.search-input {
  min-width: 280px;
  height: 32px;
  padding: 6px 10px;
  border-radius: 6px;
  color: #fff;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.2);
}


/* CHIPS */
.chip {
  background: none;
  border: none;
  padding: 4px;
  cursor: pointer;
  opacity: 0.6;
  transition: opacity 0.2s, transform 0.15s;
}
.chip:hover {
  opacity: 1;
  transform: translateY(-1px);
}
.chip.active {
  opacity: 1;
}
.class-chip img {
  width: 36px;
  height: 36px;
  filter: grayscale(100%) brightness(1.2);
}
.class-chip.active img {
  filter: brightness(1.4);
}
.role-chip img {
  width: 36px;
  height: 36px;
  filter: grayscale(100%) brightness(1.2);
}

.role-chip.active img {
  filter: brightness(1.4);
}

/* RARITY STARS */
/* Grundzustand: Outline */
.rarity-star {
  width: 28px;
  height: 28px;

  fill: none;                /* ðŸ‘ˆ nicht gefÃ¼llt */
  stroke: currentColor;      /* ðŸ‘ˆ Kontur in Rarity-Farbe */
  stroke-width: 1.2;

  transition:
    fill 0.2s ease,
    filter 0.2s ease,
    transform 0.15s ease;
}
.rarity-chip.common { color: #4ade80; }
.rarity-chip.epic { color: #a855f7; }
.rarity-chip.legendary { color: #facc15; }
.rarity-chip.active .rarity-star {
  fill: currentColor;
  opacity: 1;

  filter:
    drop-shadow(0 0 6px currentColor)
    drop-shadow(0 0 12px rgba(255,255,255,0.15));
}

.rarity-chip:hover .rarity-star {
  fill: currentColor;
  opacity: 0.4;
}


.hero-counter {
  margin-bottom: 24px;
  margin-top: 16px;
  text-align: center;
}
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, 210px);
  gap: 20px;
  justify-content: flex-start; /* ðŸ‘ˆ wichtig */
}

/* ================================
   HERO WRAPPER â€“ GLOW BASIS
   ================================ */

.hero-wrapper {
  position: relative;
  width: 210px;
  border-radius: 6px;
}

/* Common */
.hero-wrapper.rarity-common {
  border: 1px solid rgba(74, 222, 128, 0.55); /* grÃ¼n */
}

/* Epic */
.hero-wrapper.rarity-epic {
  border: 1px solid rgba(168, 85, 247, 0.6); /* purple */
}

/* Legendary */
.hero-wrapper.rarity-legendary {
  border: 1px solid rgba(250, 204, 21, 0.75); /* gold */
}

/* Grund-Glow (aus) */
.hero-wrapper::before {
  content: "";
  position: absolute;
  inset: -14px;
    pointer-events: none;

  border-radius: 20px;

  opacity: 0;
  filter: blur(18px);

  pointer-events: none;
  transition: opacity 0.4s ease, filter 0.4s ease;
}

/* Legendary Grundzustand */
.hero-wrapper.rarity-legendary::before {
  background: radial-gradient(
    circle at 50% 20%,
    rgba(255, 215, 100, 0.7),
    rgba(255, 215, 100, 0.25) 45%,
    transparent 70%
  );
  opacity: 0.25;
}

/* Epic Grundzustand */
.hero-wrapper.rarity-epic::before {
  background: radial-gradient(
    circle at 50% 20%,
    rgba(160, 90, 255, 0.6),
    rgba(160, 90, 255, 0.25) 45%,
    transparent 70%
  );
  opacity: 0.6;
}

/* ================================
   HOVER: LEGENDARY BOOST
   ================================ */

.hero-wrapper.rarity-legendary .hero-card:hover::before {
  transform: scale(1.18); /* ðŸ‘ˆ etwas stÃ¤rker als normal */
}

/* Glow verstÃ¤rken bei Hover */
.hero-wrapper.rarity-legendary:hover::before {
  opacity: 1;
  filter: blur(26px);
}


/* ICON STACK */
.icon-stack {
  position: absolute;
  top: 10px;
  left: -14px;
  display: flex;
  flex-direction: column;
  gap: 6px;
  z-index: 10;
}
.icon-stack img {
  width: 20px;
  height: 20px;
  background: #0e0e0e;
  border-radius: 50%;
  padding: 3px;
  border: 1px solid rgba(255,255,255,0.25);
}

/* RESET BUTTON */
.reset-button {
  height: 36px;
  padding: 0 18px;

  display: inline-flex;
  align-items: center;
  justify-content: center;

  font-size: 0.85rem;
  font-weight: 500;

  color: #e6e6eb;
  background: rgba(255, 255, 255, 0.08);

  border: 1px solid rgba(255, 255, 255, 0.25);
  border-radius: 999px; /* ðŸ‘ˆ richtig rund */

  cursor: pointer;

  transition:
    background 0.2s ease,
    border-color 0.2s ease,
    transform 0.15s ease;
}
.reset-button:hover {
  background: rgba(255, 255, 255, 0.14);
  border-color: rgba(255, 255, 255, 0.4);
  transform: translateY(-1px);
}

.reset-button:active {
  transform: translateY(0);
}

</style>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const searchInput = document.getElementById("searchInput");
  const resetButton = document.getElementById("resetFilters");
  const heroCounter = document.getElementById("heroCounter");
  const roleChips = document.querySelectorAll(".role-chip");

  const heroCards = document.querySelectorAll(".hero-wrapper");
  const classChips = document.querySelectorAll(".class-chip");
  const rarityChips = document.querySelectorAll(".rarity-chip");
  
  let activeRoles = new Set();  
  let activeClasses = new Set();
  let activeRarities = new Set();

  function applyFilters() {
  const query = (searchInput.value || "").toLowerCase();
  let visible = 0;

  heroCards.forEach(card => {
    const name = card.dataset.name;
    const cls = card.dataset.class;
    const role = card.dataset.role;
    const rarity = card.dataset.rarity;

    const matchesSearch =
      !query ||
      name.includes(query) ||
      cls.includes(query) ||
      role.includes(query) ||
      rarity.includes(query);

    const matchesClass =
      activeClasses.size === 0 || activeClasses.has(cls);

    const matchesRole =
      activeRoles.size === 0 || activeRoles.has(role);

    const matchesRarity =
      activeRarities.size === 0 || activeRarities.has(rarity);

    const show =
      matchesSearch && matchesClass && matchesRole && matchesRarity;

    card.style.display = show ? "block" : "none";
    if (show) visible++;
  });

  heroCounter.textContent =
    visible === 1 ? "1 Hero shown" : `${visible} Heroes shown`;
}


  searchInput.addEventListener("input", applyFilters);

  roleChips.forEach(chip => {
    chip.addEventListener("click", () => {
      const r = chip.dataset.role;

      if (activeRoles.has(r)) {
        activeRoles.delete(r);
        chip.classList.remove("active");
      } else {
        activeRoles.add(r);
        chip.classList.add("active");
      }

      applyFilters();
    });
  });

  classChips.forEach(chip => {
    chip.addEventListener("click", () => {
      const c = chip.dataset.class;
      chip.classList.toggle("active");
      activeClasses.has(c) ? activeClasses.delete(c) : activeClasses.add(c);
      applyFilters();
    });
  });

  rarityChips.forEach(chip => {
    chip.addEventListener("click", () => {
      const r = chip.dataset.rarity;
      chip.classList.toggle("active");
      activeRarities.has(r) ? activeRarities.delete(r) : activeRarities.add(r);
      applyFilters();
    });
  });

  resetButton.addEventListener("click", () => {
    searchInput.value = "";
    activeClasses.clear();
    activeRarities.clear();
    activeRoles.clear();
    document.querySelectorAll(".chip.active").forEach(c => c.classList.remove("active"));
    applyFilters();
    document.querySelectorAll(".role-chip.active").forEach(c => c.classList.remove("active"));
  });

  applyFilters();
});
</script>
